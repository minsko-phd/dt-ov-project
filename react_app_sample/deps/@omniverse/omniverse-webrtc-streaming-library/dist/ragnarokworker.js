var $module$exports$output$stats$webrtcbinarystats$statsConfig$depr$$={size:70,version:1,name:"DEPR"},$module$exports$output$stats$webrtcbinarystats$statsConfig$rtpv$$={size:80,version:3,name:"RTPV"},$module$exports$output$stats$webrtcbinarystats$statsConfig$rtpa$$={size:48,version:1,name:"RTPA"},$module$exports$output$stats$webrtcbinarystats$statsConfig$traa$$={size:88,version:1,name:"TRAA"},$module$exports$output$stats$webrtcbinarystats$statsConfig$trav$$={size:44,version:1,name:"TRAV"},$module$exports$output$stats$webrtcbinarystats$statsConfig$vfmd$$={size:12,version:1,name:"VFMD"},$module$exports$output$stats$webrtcbinarystats$statsConfig$pfda$$={size:20,version:1,name:"PFDA"},$module$exports$output$stats$webrtcbinarystats$statsConfig$none$$={size:0,version:1,name:""};function $JSCompiler_StaticMethods_createWebSocket$$(t,$=!1){try{let e;t.url.includes("wss")&&(e="x-nv-sessionid."+t.sessionId,t.accessToken&&(e+="-Authorization.Bearer-"+t.accessToken));let o=t.url;$&&(o+="&reconnect=1");let r=new WebSocket(o,e);r.onopen=()=>{if(t.$h$("{aaf44dc}"),t.$l$.$openHandler$(),r===t.$g$){for(const $ of t.$j$)$.stats?r.send($.stats):r.send(JSON.stringify($));for(const $ of t.$o$)$JSCompiler_StaticMethods_sendOnWsReliablyIfNeeded$$(t,$);t.$o$=[]}},r.onclose=$=>{t.$h$("{7a09ad8}"),t.$l$.$closeHandler$({error:t.$s$,code:$.code,reason:$.reason,wasClean:$.wasClean}),r===t.$g$&&(t.$g$=void 0),t.$s$=!1},r.onerror=()=>{t.$h$("{418a180}"),t.$s$=!0},r.onmessage=$=>{if($=JSON.parse($.data),t.serverSupportsAck&&$JSCompiler_StaticMethods_setHeartBeatTimeout$$(t),void 0===$.ackid||t.serverSupportsAck||(t.serverSupportsAck=!0,t.$h$("{523f5b9}"),$JSCompiler_StaticMethods_setHeartBeatTimeout$$(t)),!$.hb)if(t.serverSupportsAck){if(void 0!==$.ack){var e=$.ack;for(let $=t.$j$.length-1;0<=$;$--)t.$j$[$].ackid<=e&&t.$j$.splice($,1)}void 0!==$.ackid?(t.maxReceivedAckId<$.ackid&&(t.$l$.$messageHandler$($),t.maxReceivedAckId=$.ackid),t.$g$&&($=JSON.stringify({ack:t.maxReceivedAckId}),t.$h$("{903be10}"+$),t.$g$.send($))):void 0===$.ack&&t.$l$.$messageHandler$($)}else t.$l$.$messageHandler$($)},t.$g$=r}catch($){t.$g$=void 0,t.$u$("WebSocket creation exception: "+$)}}function $JSCompiler_StaticMethods_clearHeartBeatTimeout$$(t){0!==t.$m$&&(self.clearTimeout(t.$m$),t.$m$=0)}function $JSCompiler_StaticMethods_setHeartBeatTimeout$$(t){$JSCompiler_StaticMethods_clearHeartBeatTimeout$$(t),t.$m$=self.setTimeout((()=>{var $;t.$h$("{6c3505a}"+(null===($=t.$g$)||void 0===$?void 0:$.readyState)),t.$g$||$JSCompiler_StaticMethods_createWebSocket$$(t,!0),$JSCompiler_StaticMethods_setHeartBeatTimeout$$(t)}),3e3)}function $JSCompiler_StaticMethods_sendOnWsReliablyIfNeeded$$(t,$){void 0!==$.ackid&&t.serverSupportsAck&&void 0!==$.ackid&&t.$j$.push($),t.$g$&&($.stats?t.$g$.send($.stats):t.$g$.send(JSON.stringify($)))}var $module$exports$output$websocketimpl$WebSocketImpl$$=class{constructor(){var t={$messageHandler$:$module$contents$output$ragnarokworker_wsMessageHandler$$,$openHandler$:$module$contents$output$ragnarokworker_wsOpenHandler$$,$closeHandler$:$module$contents$output$ragnarokworker_wsCloseHandler$$,$openingHandler$:$module$contents$output$ragnarokworker_wsOpeningHandler$$},$=$module$contents$output$ragnarokworker_workerLogger$$,e=$module$contents$output$ragnarokworker_workerException$$;this.sessionId=$module$contents$output$ragnarokworker_sessionId$$,this.accessToken="",this.serverSupportsAck=this.$s$=!1,this.$j$=[],this.$o$=[],this.maxReceivedAckId=this.$m$=0,this.url="",this.$h$=$,this.$u$=e,this.$l$=t}initialize(t,$,e,o=!1){this.url=t,this.maxReceivedAckId=$,this.serverSupportsAck=e,$JSCompiler_StaticMethods_createWebSocket$$(this,o),this.$h$("{f4b05a4}")}uninitialize(t){var $;this.maxReceivedAckId=0,this.serverSupportsAck=!1,this.$j$=[],this.$o$=[],$JSCompiler_StaticMethods_clearHeartBeatTimeout$$(this),null===($=this.$g$)||void 0===$||$.close(t),this.$h$("{986b258}"+t)}reconnect(){$JSCompiler_StaticMethods_createWebSocket$$(this,!0)}send(t){this.serverSupportsAck||this.$g$||$JSCompiler_StaticMethods_createWebSocket$$(this,!0),this.$g$&&this.$g$.readyState===WebSocket.OPEN?$JSCompiler_StaticMethods_sendOnWsReliablyIfNeeded$$(this,t):this.$o$.push(t)}};const $module$contents$output$ragnarokworker_ctx$$=self;let $module$contents$output$ragnarokworker_perfs$$=[],$module$contents$output$ragnarokworker_clientEvents$$=[];function $JSCompiler_StaticMethods_addReport$$(t){var $=$module$contents$output$ragnarokworker_webrtcBinaryStats$$;let e=$.$g$.get(t.type);e||(e=[],$.$g$.set(t.type,e));for(const $ of t.stats)e.push($)}function $JSCompiler_StaticMethods_getStatsConfig$$(t){switch(t){case 0:return $module$exports$output$stats$webrtcbinarystats$statsConfig$depr$$;case 1:return $module$exports$output$stats$webrtcbinarystats$statsConfig$rtpv$$;case 2:return $module$exports$output$stats$webrtcbinarystats$statsConfig$rtpa$$;case 3:return $module$exports$output$stats$webrtcbinarystats$statsConfig$trav$$;case 4:return $module$exports$output$stats$webrtcbinarystats$statsConfig$traa$$;case 5:return $module$exports$output$stats$webrtcbinarystats$statsConfig$vfmd$$;case 6:return $module$exports$output$stats$webrtcbinarystats$statsConfig$pfda$$;default:return $module$exports$output$stats$webrtcbinarystats$statsConfig$none$$}}let $module$contents$output$ragnarokworker_webSocket$$,$module$contents$output$ragnarokworker_webrtcBinaryStats$$=new class{constructor(){this.$g$=new Map,this.$g$.clear()}size(){let t=0;for(let[,$]of this.$g$){let e=$;for(let $ of e)t+=$.byteLength}return t+9*this.$g$.size}write(t,$){var e=$;for(let[a,s]of this.$g$){var o=e,r=e;e=($=s).length;var n=$JSCompiler_StaticMethods_getStatsConfig$$(a);let u=n.name,c=new DataView(t.buffer);for(let t=0;4>t;t++)c.setUint8(r+t,u.charCodeAt(t));c.setUint8(r+4,n.version),c.setUint16(r+5,e,!0),c.setUint16(r+7,n.size,!0),o=e=o+9,r=t,n=0;for(let t of $)$=new Uint8Array(t),r.set($,e+n),n+=t.byteLength;e=o+n}return e}},$module$contents$output$ragnarokworker_sessionId$$="",$module$contents$output$ragnarokworker_url$$="",$module$contents$output$ragnarokworker_statsHeaderObj$$=null,$module$contents$output$ragnarokworker_uploadIntervalId$$=0,$module$contents$output$ragnarokworker_streamingQuality$$=[],$module$contents$output$ragnarokworker_mtbDurations$$=[],$module$contents$output$ragnarokworker_inputChannelStats$$=[],$module$contents$output$ragnarokworker_garbageCollectionStats$$=[],$module$contents$output$ragnarokworker_serverSupportsAck$$=!1,$module$contents$output$ragnarokworker_nextAckIdToSendForStats$$=0;function $module$contents$output$ragnarokworker_workerLogger$$(t){$module$contents$output$ragnarokworker_ctx$$.postMessage({log:t})}function $module$contents$output$ragnarokworker_workerException$$(t){$module$contents$output$ragnarokworker_ctx$$.postMessage({exception:t})}function $module$contents$output$ragnarokworker_clearCachedData$$(){$module$contents$output$ragnarokworker_perfs$$=[],$module$contents$output$ragnarokworker_clientEvents$$=[],$module$contents$output$ragnarokworker_webrtcBinaryStats$$.$g$.clear(),$module$contents$output$ragnarokworker_streamingQuality$$=[],$module$contents$output$ragnarokworker_mtbDurations$$=[],$module$contents$output$ragnarokworker_inputChannelStats$$=[],$module$contents$output$ragnarokworker_garbageCollectionStats$$=[]}function $module$contents$output$ragnarokworker_writeChunkHeader$$(t,$,e,o,r,n){for(let o=0;4>o;o++)t.setUint8($+o,e.charCodeAt(o));t.setUint8($+4,o),t.setUint16($+5,r,!0),t.setUint16($+7,n,!0)}function $module$contents$output$ragnarokworker_asInt32$$(t){return 0>t?Math.max(t,-2147483648):Math.min(t,4294967295)}function $module$contents$output$ragnarokworker_uploadData$$(){if(($module$contents$output$ragnarokworker_perfs$$.length||$module$contents$output$ragnarokworker_clientEvents$$.length)&&$module$contents$output$ragnarokworker_statsHeaderObj$$)try{$module$contents$output$ragnarokworker_statsHeaderObj$$.ackid=$module$contents$output$ragnarokworker_serverSupportsAck$$?$module$contents$output$ragnarokworker_nextAckIdToSendForStats$$:void 0;var t=JSON.stringify($module$contents$output$ragnarokworker_statsHeaderObj$$);r=(e=t.length)+2;var $=new ArrayBuffer(r);const k=new DataView($);k.setUint16(0,e);for(var e=2;e<r;++e)k.setUint8(e,t.charCodeAt(e-2));o=new Uint8Array($),n=13*$module$contents$output$ragnarokworker_perfs$$.length,a=72*$module$contents$output$ragnarokworker_clientEvents$$.length,u=12*$module$contents$output$ragnarokworker_streamingQuality$$.length,c=10*$module$contents$output$ragnarokworker_mtbDurations$$.length,l=12*$module$contents$output$ragnarokworker_inputChannelStats$$.length;const d=16*$module$contents$output$ragnarokworker_garbageCollectionStats$$.length;let p=9+o.length;n&&(p+=9+n),a&&(p+=9+a),u&&(p+=9+u),c&&(p+=9+c),l&&(p+=9+l),d&&(p+=9+d),p+=$module$contents$output$ragnarokworker_webrtcBinaryStats$$.size();const g=new ArrayBuffer(p);if(i=new DataView(g),t=0,new Uint8Array(g).set(o),$module$contents$output$ragnarokworker_writeChunkHeader$$(i,t+=o.length,"BPRF",1,0,0),t+=9,n){$module$contents$output$ragnarokworker_writeChunkHeader$$(i,t,"PERF",2,$module$contents$output$ragnarokworker_perfs$$.length,13);var o=i,r=t+=9;for($=0;$<$module$contents$output$ragnarokworker_perfs$$.length;$++)o.setFloat64(r,$module$contents$output$ragnarokworker_perfs$$[$].RAFTS,!0),o.setUint16(r+8,Math.min(1e3*$module$contents$output$ragnarokworker_perfs$$[$].DCSend,65535),!0),o.setUint16(r+10,Math.min(1e3*$module$contents$output$ragnarokworker_perfs$$[$].GetStats,65535),!0),o.setUint8(r+12,$module$contents$output$ragnarokworker_perfs$$[$].FrameInfo),r+=13;t+=n}if(a){$module$contents$output$ragnarokworker_writeChunkHeader$$(i,t,"EVNT",1,$module$contents$output$ragnarokworker_clientEvents$$.length,72);var n=i;for(o=t+=9,r=0;r<$module$contents$output$ragnarokworker_clientEvents$$.length;r++){for(n.setFloat64(o,$module$contents$output$ragnarokworker_clientEvents$$[r].TS,!0),o+=8,s=$module$contents$output$ragnarokworker_clientEvents$$[r].eventtype,$=0;$<s.length&&63>$;$++)n.setUint8(o+$,s.charCodeAt($));n.setUint8(o+$,0),o+=64}t+=a}if(u){$module$contents$output$ragnarokworker_writeChunkHeader$$(i,t,"SQEV",1,$module$contents$output$ragnarokworker_streamingQuality$$.length,12);var a=i,s=t+=9;for(n=0;n<$module$contents$output$ragnarokworker_streamingQuality$$.length;n++)a.setUint8(s,$module$contents$output$ragnarokworker_streamingQuality$$[n].qualityScore),a.setUint8(s+1,$module$contents$output$ragnarokworker_streamingQuality$$[n].bandwidthScore),a.setUint8(s+2,$module$contents$output$ragnarokworker_streamingQuality$$[n].latencyScore),a.setUint8(s+3,$module$contents$output$ragnarokworker_streamingQuality$$[n].networkLossScore),a.setFloat64(s+4,$module$contents$output$ragnarokworker_streamingQuality$$[n].timestamp,!0),s+=12;t+=u}if(c){$module$contents$output$ragnarokworker_writeChunkHeader$$(i,t,"MTBD",1,$module$contents$output$ragnarokworker_mtbDurations$$.length,10);var u=i;for(a=t+=9,s=0;s<$module$contents$output$ragnarokworker_mtbDurations$$.length;s++)u.setFloat64(a,$module$contents$output$ragnarokworker_mtbDurations$$[s].timestamp,!0),u.setUint16(a+8,Math.min($module$contents$output$ragnarokworker_mtbDurations$$[s].duration,65535),!0),a+=10;t+=c}if(l){$module$contents$output$ragnarokworker_writeChunkHeader$$(i,t,"INPT",1,$module$contents$output$ragnarokworker_inputChannelStats$$.length,12);var c=i;for(u=t+=9,a=0;a<$module$contents$output$ragnarokworker_inputChannelStats$$.length;a++)c.setFloat64(u,$module$contents$output$ragnarokworker_inputChannelStats$$[a].timestamp,!0),c.setUint16(u+8,Math.min($module$contents$output$ragnarokworker_inputChannelStats$$[a].bufferedAmount,65535),!0),c.setUint16(u+10,Math.min($module$contents$output$ragnarokworker_inputChannelStats$$[a].maxSchedulingDelay,65535),!0),u+=12;t+=l}if(d){$module$contents$output$ragnarokworker_writeChunkHeader$$(i,t,"GRBG",1,$module$contents$output$ragnarokworker_garbageCollectionStats$$.length,16);var l=i,i=t+=9;for(c=0;c<$module$contents$output$ragnarokworker_garbageCollectionStats$$.length;c++)l.setFloat64(i,$module$contents$output$ragnarokworker_garbageCollectionStats$$[c].timestamp,!0),l.setInt32(i+8,$module$contents$output$ragnarokworker_asInt32$$($module$contents$output$ragnarokworker_garbageCollectionStats$$[c].deltaUsedHeapSize),!0),l.setInt32(i+12,$module$contents$output$ragnarokworker_asInt32$$($module$contents$output$ragnarokworker_garbageCollectionStats$$[c].deltaTotalHeapSize),!0),i+=16;t+=d}let m=new Uint8Array(g);$module$contents$output$ragnarokworker_webrtcBinaryStats$$.write(m,t),null==$module$contents$output$ragnarokworker_webSocket$$||$module$contents$output$ragnarokworker_webSocket$$.send({stats:g,ackid:$module$contents$output$ragnarokworker_serverSupportsAck$$?$module$contents$output$ragnarokworker_nextAckIdToSendForStats$$:void 0})}catch(t){$module$contents$output$ragnarokworker_workerException$$("Exception in perf/stats upload. Error : "+t.message+" stack: "+t.stack)}$module$contents$output$ragnarokworker_clearCachedData$$()}function $module$contents$output$ragnarokworker_wsMessageHandler$$(t){$module$contents$output$ragnarokworker_serverSupportsAck$$||void 0===t.ackid||($module$contents$output$ragnarokworker_serverSupportsAck$$=!0),$module$contents$output$ragnarokworker_ctx$$.postMessage({wsMessage:t})}function $module$contents$output$ragnarokworker_wsCloseHandler$$(t){$module$contents$output$ragnarokworker_ctx$$.postMessage({wsClose:t})}function $module$contents$output$ragnarokworker_wsOpenHandler$$(){$module$contents$output$ragnarokworker_ctx$$.postMessage({wsOpen:!0})}function $module$contents$output$ragnarokworker_wsOpeningHandler$$(){$module$contents$output$ragnarokworker_ctx$$.postMessage({wsOpening:!0})}function $module$contents$output$ragnarokworker_createWebSocket$$(t,$){$module$contents$output$ragnarokworker_webSocket$$=new $module$exports$output$websocketimpl$WebSocketImpl$$,$module$contents$output$ragnarokworker_webSocket$$.initialize($module$contents$output$ragnarokworker_url$$,t,$module$contents$output$ragnarokworker_serverSupportsAck$$,$),$module$contents$output$ragnarokworker_wsOpeningHandler$$()}$module$contents$output$ragnarokworker_ctx$$.onmessage=function(t){try{const $=t.data;$.initMessage?($module$contents$output$ragnarokworker_sessionId$$=$.initMessage.sessionId,$module$contents$output$ragnarokworker_workerLogger$$("{6ccab8d}")):$.perf?$module$contents$output$ragnarokworker_perfs$$.push($.perf):$.clientEvent?$module$contents$output$ragnarokworker_clientEvents$$.push($.clientEvent):$.startStats?($module$contents$output$ragnarokworker_statsHeaderObj$$=$.startStats.statsHeader,$module$contents$output$ragnarokworker_uploadIntervalId$$=self.setInterval((()=>$module$contents$output$ragnarokworker_uploadData$$()),5e3),$module$contents$output$ragnarokworker_ctx$$.postMessage({statsStarted:!0}),$module$contents$output$ragnarokworker_workerLogger$$("{5209d98}")):$.stopStats?(self.clearInterval($module$contents$output$ragnarokworker_uploadIntervalId$$),$module$contents$output$ragnarokworker_uploadData$$(),$module$contents$output$ragnarokworker_clearCachedData$$(),$module$contents$output$ragnarokworker_workerLogger$$("{b58b6ad}")):$.webrtcStats?($.ackid&&($module$contents$output$ragnarokworker_nextAckIdToSendForStats$$=$.ackid),$.webrtcStats.stats&&$JSCompiler_StaticMethods_addReport$$($.webrtcStats)):$.sq?$module$contents$output$ragnarokworker_streamingQuality$$.push($.sq):$.startWebSocket?($module$contents$output$ragnarokworker_url$$=$.startWebSocket.signInURL,$module$contents$output$ragnarokworker_serverSupportsAck$$=$.startWebSocket.serverSupportsAck,$module$contents$output$ragnarokworker_createWebSocket$$($.startWebSocket.maxReceivedAckId,$.startWebSocket.reconnect)):$.stopWebSocket?(null==$module$contents$output$ragnarokworker_webSocket$$||$module$contents$output$ragnarokworker_webSocket$$.uninitialize(),$module$contents$output$ragnarokworker_serverSupportsAck$$=!1):$.send?null==$module$contents$output$ragnarokworker_webSocket$$||$module$contents$output$ragnarokworker_webSocket$$.send($.send):$.duration?$module$contents$output$ragnarokworker_mtbDurations$$.push($.duration):$.inputChannelStats?$module$contents$output$ragnarokworker_inputChannelStats$$.push($.inputChannelStats):$.garbageCollectionStats&&$module$contents$output$ragnarokworker_garbageCollectionStats$$.push($.garbageCollectionStats)}catch(t){$module$contents$output$ragnarokworker_workerException$$("Worker onmessage exception: "+t)}};